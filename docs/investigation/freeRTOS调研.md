# freeRTOS调研

### 1. 为什么要使用freeRTOS

我们刚开始接触的单片机编程通常都是指裸机编程，即不加入任何 RTOS 的程序。在裸机系统中，所有的程序基本都是自己写的，所有的操作都是在一个无限的大循环 里面实现。但如果要实现的功能很多，编程就会变得非常困难。而freeRTOS是实时多任务操作系统，我们只需要将各个功能独立地实现，再通过freeRTOS来进行任务管理就能实现多功能的协调运行，大大降低我们的编码难度。

### 2. freeRTOS的任务管理

##### (1). 任务创建

freeRTOS中使用xTaskCreate()函数来动态创建任务，创建时可设置任务名称、任务栈的大小，参数和优先级等。

##### (2). 任务状态

任务切换的基础tick中断，freeRTOS中的任务有Ready、Running、Suspended、Blocked四种状态

- **Ready**：等待执行的任务。任务创建完成后即进入Ready状态，以链表的方式排列，当CPU空闲时，Ready状态的任务会依次进入Running状态。
- **Running：**CPU正在执行的任务。此间既可以进行任务的增删，也可以控制其他任务或者当前任务进入Suspended和Blocked状态。
- **Suspended：**处于暂停的任务。处于Suspended状态的任务不会被执行，已经暂停他的任务只能通过其他任务重新启动。
- **Blocked：**处于阻塞状态的任务。处于Blocked状态的任务在等待特定事件的发生，当特定时间发生时，任务进入Ready状态。

<img src="C:\Users\DELL\AppData\Roaming\Typora\typora-user-images\image-20230319172718544.png" alt="image-20230319172718544" style="zoom:33%;" />

##### (3). 空闲任务和钩子函数

- **空闲任务：**是freeRTOS中一类特殊的任务，不需要用户编写。空闲任务的优先级为0（最低），主要进行任务删除后的清理工作。空闲任务只能处于Running和Ready两状态。
- **钩子函数：**空闲任务在执行时会调用钩子函数，钩子函数可用户编写，一般执行一些低优先级的，后台的，需要连续执行的函数。例如测量系统的空闲时间，让系统进入省电模式等。

##### (4). 调度策略

freeRTOS的调度策略是可以设置的。具体包括：

- **是否可抢占**：CUP资源可否抢占

  **可抢占：**高优先级任务可直接中断低优先级任务，抢占CPU资源。

  **不可抢占：**高优先级任务不能抢占CPU资源，只能等待当前任务主动让出CPU资源。

- **是否交替执行**：在可抢占前提下同优先级任务是否轮流运行

  **交替执行：**当前任务在执行一个tick周期后让出资源给其他同优先级任务。

  **不交替执行：**先到先得，当前任务资源只能被更高优先级任务抢占或主动让出

- **是否空闲礼让**：空闲任务是否礼让其他优先级为0的任务

  **空闲礼让：**空闲任务在运行一个while循环后主动让出CPU资源给其他优先级为0的任务

  **不空闲礼让：**空闲任务与其他优先级为0的任务地位相同

### 3. freeRTOS的优点和不足

**优点：**

freeRTOS 操作系统是完全免费的操作系统，具有源码公开、可移植、可裁减、调度策略灵活的特点，可以方便地移植到各种单片机上运行。

[不同嵌入式操作系统的比较_CSDN](https://blog.csdn.net/weixin_42696271/article/details/116899375)

[freeRTOS的特点_CSDN](https://blog.csdn.net/qq_43940175/article/details/123158936)

**缺点：**

(1).  freeRTOS常用动态分配内存，会导致内存的碎片化

(2). freeRTOS只是一个操作系统内核，需外扩第三方的GUI(图形用户界面)、TCP／IP协议栈、FS(文件系统)等才能实现一个较复杂的系统

(3).freeRTOS中大量地使用了宏定义，可读性差



